<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ご注文フォーム</title>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        :root {
            --primary: #ec4899;
            --primary-light: #f472b6;
            --secondary: #be185d;
            --accent: #db2777;
            --dark: #831843;
            --light: #ffffff;
            --gray-50: #fdf2f8;
            --gray-100: #fce7f3;
            --gray-200: #fbcfe8;
            --gray-300: #f9a8d4;
            --gray-400: #f472b6;
            --gray-500: #ec4899;
            --gray-600: #db2777;
            --gray-700: #be185d;
            --gray-800: #9d174d;
            --blue-50: #fef7ff;
            --blue-100: #fae8ff;
            --blue-500: #f472b6;
            --green-50: #fdf2f8;
            --green-500: #f472b6;
            --pink-50: #fdf2f8;
            --pink-500: #ec4899;
            --shadow: 0 1px 3px 0 rgba(236, 72, 153, 0.1), 0 1px 2px 0 rgba(236, 72, 153, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(236, 72, 153, 0.1), 0 4px 6px -2px rgba(236, 72, 153, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--gray-50) 0%, #fce7f3 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 2rem 1rem;
            line-height: 1.6;
            color: var(--gray-700);
        }

        .container {
            background: var(--light);
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 600px;
            padding: 3rem;
            position: relative;
            border: 1px solid var(--gray-200);
            backdrop-filter: blur(10px);
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--secondary));
            border-radius: 20px 20px 0 0;
        }

        h1 {
            color: var(--gray-800);
            font-size: 2.25rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 2rem;
            letter-spacing: -0.025em;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-header {
            display: block;
            margin: 3rem 0 1.5rem;
            padding: 1.25rem 2rem;
            font-weight: 700;
            font-size: 1.125rem;
            text-align: center;
            color: var(--light);
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.3);
            position: relative;
            overflow: hidden;
        }

        .section-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .label {
            display: block;
            margin: 2rem 0 1rem;
            padding: 1rem 1.5rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--gray-50), var(--gray-100));
            border-radius: 16px;
            font-size: 1rem;
            text-align: center;
            color: var(--gray-800);
            border: 1px solid var(--gray-200);
            transition: all 0.3s ease-in-out;
        }

        .label:hover {
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.15);
            transform: translateY(-2px);
        }

        .required {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            font-weight: 500;
            font-size: 0.75rem;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            margin-right: 0.75rem;
            display: inline-block;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
        }

        .optional {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            color: #64748b;
            font-weight: 500;
            font-size: 0.75rem;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            margin-right: 0.75rem;
            display: inline-block;
            box-shadow: 0 2px 8px rgba(148, 163, 184, 0.15);
            border: 1px solid #e2e8f0;
        }

        input[type="text"],
        input[type="tel"],
        textarea {
            width: 100%;
            padding: 1rem 1.25rem;
            margin-bottom: 1.5rem;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            background-color: var(--light);
            transition: all 0.3s ease-in-out;
            resize: vertical;
            min-height: 48px;
            color: var(--gray-700);
        }

        input[type="text"]:focus,
        input[type="tel"]:focus,
        textarea:focus {
            border-color: var(--primary);
            background-color: var(--gray-50);
            outline: none;
            box-shadow: 0 0 0 4px rgba(236, 72, 153, 0.1);
            transform: translateY(-1px);
        }

        .postal-input-container {
            display: flex;
            gap: 0.5rem;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .postal-input {
            flex: 1;
        }

        .postal-search-btn {
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, var(--accent), var(--primary));
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.3);
            min-height: 48px;
            white-space: nowrap;
        }

        .postal-search-btn:hover {
            background: linear-gradient(135deg, var(--secondary), var(--dark));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(236, 72, 153, 0.4);
        }

        .postal-search-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .one-buttons, .two-buttons, .first-time-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
            margin: 1.5rem 0 2rem;
        }

        .first-time-buttons {
            grid-template-columns: repeat(2, 1fr);
        }

        .one-buttons button, .two-buttons button, .first-time-buttons button {
            padding: 1rem 1.25rem;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            background: linear-gradient(135deg, var(--light), var(--gray-50));
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--gray-600);
            transition: all 0.3s ease-in-out;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .one-buttons button:hover, .two-buttons button:hover, .first-time-buttons button:hover {
            border-color: var(--gray-300);
            background: linear-gradient(135deg, var(--gray-50), var(--gray-100));
            color: var(--gray-700);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.15);
        }

        .active {
            background: linear-gradient(135deg, var(--primary), var(--accent)) !important;
            color: white !important;
            border-color: var(--primary) !important;
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.4) !important;
        }

        .active:hover {
            background: linear-gradient(135deg, var(--accent), var(--secondary)) !important;
            border-color: var(--accent) !important;
            box-shadow: 0 6px 20px rgba(236, 72, 153, 0.5) !important;
        }

        .submit-button {
            width: 100%;
            padding: 1.25rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--accent), var(--primary));
            color: white;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            margin-top: 2rem;
            box-shadow: 0 6px 20px rgba(236, 72, 153, 0.3);
            position: relative;
            overflow: hidden;
        }

        .submit-button:hover {
            background: linear-gradient(135deg, var(--secondary), var(--dark));
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(236, 72, 153, 0.4);
        }

        .info-text {
            margin: 2rem 0;
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--gray-50), var(--gray-100));
            border-radius: 16px;
            border-left: 4px solid var(--primary);
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--gray-700);
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.1);
        }

        .side-nav {
            position: fixed;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, var(--light), var(--gray-50));
            padding: 1rem;
            border-radius: 20px;
            z-index: 1000;
            box-shadow: 0 8px 25px rgba(236, 72, 153, 0.2);
            border: 1px solid var(--gray-200);
            backdrop-filter: blur(10px);
        }

        .side-nav a {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--gray-600);
            text-decoration: none;
            font-size: 0.75rem;
            padding: 0.75rem;
            transition: all 0.3s ease-in-out;
            border-radius: 12px;
            width: 48px;
            height: 48px;
        }

        .side-nav a:hover {
            background: linear-gradient(135deg, var(--gray-100), var(--gray-200));
            color: var(--primary);
            transform: scale(1.05);
        }

        .side-nav a span {
            font-size: 1.25rem;
            margin-bottom: 0.125rem;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            color: #dc2626;
            font-size: 0.85rem;
            margin-top: 0.5rem;
            margin-bottom: 1rem;
        }

        .hidden {
            display: none;
        }

        .first-time-section {
            transition: all 0.5s ease-in-out;
            overflow: hidden;
        }

        .slide-in {
            animation: slideInFromBottom 0.6s ease-out forwards;
        }

        @keyframes slideInFromBottom {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 2rem 1.5rem;
                margin: 1rem;
                border-radius: 16px;
            }

            h1 {
                font-size: 1.875rem;
                margin-bottom: 1.5rem;
            }

            .section-header {
                margin: 2.5rem 0 1rem;
                padding: 1rem 1.5rem;
                font-size: 1rem;
                border-radius: 12px;
            }

            .one-buttons, .two-buttons, .first-time-buttons {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .postal-input-container {
                flex-direction: column;
            }

            .postal-search-btn {
                width: 100%;
            }

            .side-nav {
                right: 0.5rem;
                padding: 0.75rem;
                border-radius: 16px;
            }

            .side-nav a {
                width: 40px;
                height: 40px;
                font-size: 0.7rem;
                border-radius: 8px;
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .container {
            animation: fadeInUp 0.8s ease-out;
        }

        .section-header {
            animation: float 6s ease-in-out infinite;
        }
    </style>
</head>

<body>
    <!-- 右側の追従ナビ -->
    <div class="side-nav" id="sideNav">
        <a href="#section-message">
            <span>⇩</span>
            <i class="fas fa-comment"></i>
        </a>
    </div>

    <div class="container">
        <h1>ご注文ページ</h1>
        
        <div class="section-header"><span class="required">必須</span>お名前をお願いします</div>
        <div class="info-text">LINEとは連動してませんのでお手数ですがお名前の記載お願いします</div>
        <input type="text" id="lastName" placeholder="姓" />
        <input type="text" id="firstName" placeholder="名" />

        <div class="section-header"><span class="optional">任意</span>ご注文の商品をご記入ください</div>
        <div class="info-text">・商品名、色番号<br>・数量<br>・その他ご不明な点があればなんでもどうぞ</div>
        <textarea id="orderDetails" rows="4" placeholder="ご注文内容をご記入ください"></textarea>

        <div class="section-header"><span class="required">必須</span>お支払い方法を選んでください</div>
        <div class="one-buttons">
            <button type="button" class="one" onclick="selectPayment(this)">paypay</button>
            <button type="button" class="one" onclick="selectPayment(this)">銀行振込</button>
            <button type="button" class="one" onclick="selectPayment(this)">クレジットカード</button>
            <button type="button" class="one" onclick="selectPayment(this)">店頭支払</button>
        </div>

        <div class="section-header"><span class="required">必須</span>お届け方法を選択して下さい</div>
        <div class="two-buttons">
            <button type="button" class="two" onclick="selectDelivery(this)">宅配（送料無料）</button>
            <button type="button" class="two" onclick="selectDelivery(this)">店頭受け取り</button>
        </div>

        <!-- 初回注文確認セクション -->
        <div class="section-header"><span class="required">必須</span>ご注文は初めてですか？</div>
        <div class="first-time-buttons">
            <button type="button" class="first-time" onclick="selectFirstTime(this, true)">はい</button>
            <button type="button" class="first-time" onclick="selectFirstTime(this, false)">いいえ</button>
        </div>

        <!-- 初回注文者向けのセクション -->
        <div id="firstTimeSection" class="first-time-section hidden">
            <div class="label"><span class="required">必須</span>初回のお客様 - お電話番号</div>
            <div class="info-text">日中連絡がつく番号でお願いします</div>
            <input type="tel" id="phone" placeholder="電話番号を入力してください" />

            <div class="label"><span class="required">必須</span>初回のお客様 - お届け先住所</div>
            <div class="info-text">個人情報のセキュリティ管理はしっかりさせていただいております。<br>ご安心してご記入ください。</div>
            
            <div class="label">郵便番号</div>
            <div class="postal-input-container">
                <input type="text" id="postalCode" class="postal-input" placeholder="例: 1000001" maxlength="7" />
                <button type="button" class="postal-search-btn" onclick="searchAddress()" id="searchBtn">
                    住所検索
                </button>
            </div>
            <div class="error-message" id="postalError" style="display: none;"></div>

            <div class="label">都道府県</div>
            <input type="text" id="prefecture" placeholder="都道府県" readonly />

            <div class="label">市区町村</div>
            <input type="text" id="city" placeholder="市区町村" readonly />

            <div class="label">番地</div>
            <input type="text" id="address" placeholder="番地を入力してください" />

            <div class="label">マンション・ビル名</div>
            <input type="text" id="building" placeholder="マンション・ビル名（任意）" />
        </div>

        <button class="submit-button" onclick="submitForm()" id="section-message">送信</button>
    </div>

    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script>
        let paymentMethod = '';
        let deliveryMethod = '';
        let isFirstTime = null;

        // LIFF初期化
        document.addEventListener('DOMContentLoaded', function () {
            liff.init({
                liffId: '2007458512-xZR3av9K' // ここにあなたのLIFF IDを入力
            }).then(() => {
                console.log('LIFF初期化成功');
            }).catch((err) => {
                console.error('LIFF初期化失敗', err);
            });
        });

        function selectPayment(element) {
            const buttons = document.querySelectorAll('.one-buttons button');
            buttons.forEach(button => button.classList.remove('active'));
            element.classList.add('active');
            paymentMethod = element.innerText;
        }

        function selectDelivery(element) {
            const buttons = document.querySelectorAll('.two-buttons button');
            buttons.forEach(button => button.classList.remove('active'));
            element.classList.add('active');
            deliveryMethod = element.innerText;
        }

        function selectFirstTime(element, firstTime) {
            const buttons = document.querySelectorAll('.first-time-buttons button');
            buttons.forEach(button => button.classList.remove('active'));
            element.classList.add('active');
            isFirstTime = firstTime;

            const firstTimeSection = document.getElementById('firstTimeSection');
            
            if (firstTime) {
                // 「はい」が選択された場合、初回注文者向けセクションを表示
                firstTimeSection.classList.remove('hidden');
                firstTimeSection.classList.add('slide-in');
            } else {
                // 「いいえ」が選択された場合、初回注文者向けセクションを非表示
                firstTimeSection.classList.add('hidden');
                firstTimeSection.classList.remove('slide-in');
                
                // フィールドをクリア
                document.getElementById('phone').value = '';
                document.getElementById('postalCode').value = '';
                document.getElementById('prefecture').value = '';
                document.getElementById('city').value = '';
                document.getElementById('address').value = '';
                document.getElementById('building').value = '';
            }
        }

        async function searchAddress() {
            const postalCode = document.getElementById('postalCode').value.replace(/[^\d]/g, '');
            const errorDiv = document.getElementById('postalError');
            const searchBtn = document.getElementById('searchBtn');
            
            // エラーメッセージをクリア
            errorDiv.style.display = 'none';
            
            if (postalCode.length !== 7) {
                errorDiv.textContent = '7桁の郵便番号を入力してください（例: 1000001）';
                errorDiv.style.display = 'block';
                return;
            }

            // ボタンを無効化してローディング表示
            searchBtn.disabled = true;
            searchBtn.innerHTML = '<span class="loading"></span> 検索中...';

            try {
                const response = await fetch(`https://zipcloud.ibsnet.co.jp/api/search?zipcode=${postalCode}`);
                const data = await response.json();

                if (data.status === 200 && data.results && data.results.length > 0) {
                    const result = data.results[0];
                    
                    // 住所情報を入力フィールドに設定
                    document.getElementById('prefecture').value = result.address1;
                    document.getElementById('city').value = result.address2 + result.address3;
                    
                    // 番地フィールドにフォーカス
                    document.getElementById('address').focus();
                } else {
                    errorDiv.textContent = '該当する住所が見つかりませんでした。郵便番号を確認してください。';
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('住所検索エラー:', error);
                errorDiv.textContent = '住所検索でエラーが発生しました。しばらくしてから再度お試しください。';
                errorDiv.style.display = 'block';
            } finally {
                // ボタンを有効化
                searchBtn.disabled = false;
                searchBtn.innerHTML = '住所検索';
            }
        }

        // エンターキーで住所検索を実行
        document.getElementById('postalCode').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchAddress();
            }
        });

        // 郵便番号入力時に数字以外を除去
        document.getElementById('postalCode').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/[^\d]/g, '');
        });

        function submitForm() {
            const formData = {
                lastName: document.getElementById('lastName').value,
                firstName: document.getElementById('firstName').value,
                orderDetails: document.getElementById('orderDetails').value,
                paymentMethod: paymentMethod,
                deliveryMethod: deliveryMethod,
                isFirstTime: isFirstTime,
                phone: document.getElementById('phone').value,
                postalCode: document.getElementById('postalCode').value,
                prefecture: document.getElementById('prefecture').value,
                city: document.getElementById('city').value,
                address: document.getElementById('address').value,
                building: document.getElementById('building').value
            };

            // 必須項目のチェック
            if (!formData.lastName || !formData.firstName) {
                alert('お名前（姓・名）を入力してください。');
                return;
            }

            if (!formData.paymentMethod) {
                alert('お支払い方法を選択してください。');
                return;
            }

            if (!formData.deliveryMethod) {
                alert('お届け方法を選択してください。');
                return;
            }

            if (formData.isFirstTime === null) {
                alert('初回注文かどうかを選択してください。');
                return;
            }

            // 初回注文の場合の必須項目チェック
            if (formData.isFirstTime) {
                if (!formData.phone) {
                    alert('初回のお客様は電話番号の入力が必要です。');
                    return;
                }
                
                if (!formData.postalCode || !formData.prefecture || !formData.city || !formData.address) {
                    alert('初回のお客様は住所情報の入力が必要です。');
                    return;
                }
            }

            // LINEトークにメッセージを送信
            let messageText = 
                '≪ご注文内容≫\n' +
                '【お名前】\n' + formData.lastName + ' ' + formData.firstName + '\n\n' +
                '【ご注文内容】\n' + (formData.orderDetails || '記載なし') + '\n\n' +
                '【お支払い方法】\n' + formData.paymentMethod + '\n\n' +
                '【お届け方法】\n' + formData.deliveryMethod + '\n\n' +
                '【初回注文】\n' + (formData.isFirstTime ? 'はい' : 'いいえ') + '\n\n';

            // 初回注文の場合のみ連絡先と住所を追加
            if (formData.isFirstTime) {
                messageText +=
                    '【お電話番号】\n' + formData.phone + '\n\n' +
                    '【お届け先住所】\n' +
                    '〒' + formData.postalCode + '\n' +
                    formData.prefecture + formData.city + '\n' +
                    formData.address + '\n' +
                    (formData.building || '');
            }

            liff.sendMessages([{
                type: 'text',
                text: messageText
            }]).then(() => {
                alert('ご注文ありがとうございます。内容を確認次第、ご連絡いたします。');
                liff.closeWindow();
            }).catch((err) => {
                console.error('メッセージの送信に失敗しました', err);
                alert('送信に失敗しました。もう一度お試しください。');
            });
        }
    </script>
</body>

</html>
